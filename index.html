<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Research Stats Tool v5.6 (Methodology Edition)</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#7c3aed">
    
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&family=Sarabun:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --primary: #7c3aed; --primary-dark: #5b21b6; --primary-light: #ddd6fe;
            --success: #10b981; --danger: #ef4444; --warning: #f59e0b;
            --gray: #6b7280; --bg-body: #f3f4f6;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Sarabun', sans-serif;
            background: linear-gradient(135deg, #e0e7ff 0%, #f3e8ff 100%);
            background-attachment: fixed; color: #1f2937; line-height: 1.6; padding-bottom: 50px;
        }
        .container { max-width: 1100px; margin: 0 auto; padding: 20px; }

        /* --- UI Elements --- */
        header { text-align: center; margin-bottom: 30px; padding-top: 20px; }
        .main-title {
            font-family: 'Prompt', sans-serif; font-size: 2.2rem; font-weight: 700;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 5px;
        }
        .subtitle { color: var(--gray); font-family: 'Prompt'; font-size: 1rem; }

        .card {
            background: white; border-radius: 16px; padding: 30px; margin-bottom: 25px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); border: 1px solid rgba(255,255,255,0.8);
        }

        .test-buttons { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-bottom: 20px; }
        .test-btn {
            padding: 10px 24px; border: 2px solid var(--primary-light); background: white;
            border-radius: 50px; font-family: 'Prompt'; font-weight: 500; cursor: pointer; transition: 0.2s; color: var(--gray);
        }
        .test-btn:hover { border-color: var(--primary); color: var(--primary); }
        .test-btn.active {
            background: var(--primary); color: white; border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
        }

        .section-title {
            font-family: 'Prompt'; font-size: 1.2rem; color: var(--primary); margin-bottom: 20px;
            display: flex; align-items: center; gap: 10px; border-bottom: 2px solid var(--primary-light); padding-bottom: 10px;
        }

        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 6px; font-weight: 600; color: #374151; font-size: 0.9rem; }
        input, select {
            width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 12px;
            font-size: 1rem; font-family: 'Sarabun'; transition: 0.2s;
        }
        input:focus, select:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 4px rgba(124, 58, 237, 0.1); }

        /* --- Co-Researcher Tags --- */
        .co-input-wrapper { display: flex; gap: 10px; }
        .add-btn {
            background: var(--primary); color: white; border: none; border-radius: 12px;
            width: 50px; cursor: pointer; font-size: 1.5rem; display: flex; align-items: center; justify-content: center;
        }
        .tag-container { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
        .tag {
            background: #eef2ff; color: var(--primary); border: 1px solid #c7d2fe;
            padding: 4px 12px; border-radius: 20px; font-size: 0.9rem; display: flex; align-items: center; gap: 6px;
        }

        /* --- Buttons --- */
        .btn-group { display: flex; gap: 12px; margin-top: 20px; }
        .btn {
            flex: 1; padding: 12px; border: none; border-radius: 12px; font-family: 'Prompt'; font-weight: 600;
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; color: white;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn:active { transform: scale(0.98); }
        .btn-primary { background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%); box-shadow: 0 4px 10px rgba(124, 58, 237, 0.3); }
        .btn-save { background: linear-gradient(135deg, #059669 0%, #10b981 100%); box-shadow: 0 4px 10px rgba(16, 185, 129, 0.3); }
        .btn-save.editing { background: linear-gradient(135deg, #d97706 0%, #f59e0b 100%); }
        .btn-print { background: linear-gradient(135deg, #ea580c 0%, #f97316 100%); box-shadow: 0 4px 10px rgba(249, 115, 22, 0.3); }
        .btn-outline { background: white; border: 2px solid #e5e7eb; color: var(--gray); }
        .btn-edu { background: #334155; color: white; }

        /* --- Settings --- */
        .settings-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px; }
        .setting-card { background: #fff; border: 2px solid #e5e7eb; padding: 15px; border-radius: 12px; position: relative; }

        /* --- Stats Summary --- */
        .stats-summary {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 20px;
        }
        .stat-item {
            background: #f8fafc; border-radius: 12px; padding: 15px; text-align: center; border: 1px solid #e2e8f0;
        }
        .stat-lbl {
            font-size: 0.8rem; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px;
        }
        .stat-val {
            font-size: 1.5rem; font-weight: 700; font-family: 'Prompt'; color: var(--primary);
        }

        /* --- Modal Popup Style --- */
        .modal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.6); backdrop-filter: blur(4px); overflow-y: auto;
        }
        .modal-content {
            background-color: #fff; margin: 5% auto; padding: 30px; border-radius: 20px;
            width: 80%; max-width: 900px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
            animation: modalSlide 0.4s ease-out;
        }
        @keyframes modalSlide { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #f1f5f9; padding-bottom: 15px; margin-bottom: 20px; }
        .modal-body { color: #334155; font-size: 1rem; line-height: 1.7; }
        .close-modal { font-size: 28px; font-weight: bold; color: #94a3b8; cursor: pointer; }
        .close-modal:hover { color: var(--danger); }
        .formula-box { background: #f8fafc; padding: 15px; border-radius: 12px; border: 1px solid #e2e8f0; margin: 15px 0; overflow-x: auto; text-align: center; }

        /* --- Results Dashboard --- */
        .result-section { display: none; animation: slideUp 0.5s ease; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .result-header { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .p-value-card, .ci-card {
            background: white; padding: 20px; border-radius: 16px; text-align: center;
            border: 2px solid #e5e7eb; display: flex; flex-direction: column; justify-content: center;
        }
        .p-value-card.sig { background: #ecfdf5; border-color: #10b981; color: #065f46; }
        .p-value-card.ns { background: #f3f4f6; border-color: #9ca3af; color: #374151; }
        .display-val { font-size: 2.2rem; font-weight: 800; font-family: 'Prompt'; line-height: 1; margin: 5px 0; }
        
        /* Analysis Box */
        .analysis-box {
            background: #fff; border: 1px solid #e2e8f0; border-left: 5px solid var(--primary);
            padding: 25px; border-radius: 12px; margin-top: 25px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
        }
        .h-badge { display: inline-block; padding: 6px 16px; border-radius: 50px; font-size: 0.9rem; font-weight: 600; margin-bottom: 15px; }
        .h-reject { background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
        .h-accept { background: #fee2e2; color: #991b1b; border: 1px solid #fecaca; }
        
        /* --- ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£ --- */
        .method-option {
            margin-bottom: 12px;
        }
        .method-label {
            display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 8px 12px; border-radius: 8px;
            transition: background 0.2s;
        }
        .method-label:hover {
            background: #f8fafc;
        }
        .method-label input[type="radio"] {
            width: 18px; height: 18px;
        }
        .info-icon {
            color: #6b7280; cursor: help; font-size: 14px;
            margin-left: auto;
        }
        .auto-recommendation {
            background: #f0f9ff; padding: 8px 12px; border-radius: 8px; border-left: 3px solid #0ea5e9;
            margin-left: 30px; font-size: 0.85rem; margin-top: 5px;
        }
        .critical-value-display {
            background: #f8fafc; padding: 10px; border-radius: 8px; margin-top: 10px; border: 1px solid #e2e8f0;
        }

        /* --- History Section --- */
        .history-section {
            margin-top: 30px;
        }
        .history-controls {
            display: flex; gap: 10px; margin-bottom: 15px; align-items: center;
        }
        .history-search {
            flex: 1; padding: 10px 15px; border: 2px solid #e5e7eb; border-radius: 12px;
            font-family: 'Sarabun'; font-size: 0.9rem;
        }
        .clear-history-btn {
            background: #ef4444; color: white; border: none; padding: 10px 20px;
            border-radius: 12px; cursor: pointer; font-family: 'Prompt'; font-weight: 600;
            display: flex; align-items: center; gap: 8px;
        }
        .history-table-container {
            overflow-x: auto; border-radius: 12px; border: 1px solid #e5e7eb;
        }
        .history-table {
            width: 100%; border-collapse: collapse; font-size: 0.9rem;
        }
        .history-table th {
            background: #f8fafc; padding: 12px 15px; text-align: left; font-weight: 600;
            color: #374151; border-bottom: 2px solid #e5e7eb; font-family: 'Prompt';
        }
        .history-table td {
            padding: 10px 15px; border-bottom: 1px solid #e5e7eb;
            vertical-align: top;
        }
        .history-table tr:hover {
            background: #f9fafb;
        }
        .action-buttons {
            display: flex; gap: 8px;
        }
        .action-btn {
            padding: 4px 8px; border-radius: 6px; border: none; cursor: pointer;
            font-size: 0.8rem; display: flex; align-items: center; gap: 4px;
        }
        .view-btn { background: #dbeafe; color: #1e40af; }
        .edit-btn { background: #fef3c7; color: #92400e; }
        .delete-btn { background: #fee2e2; color: #991b1b; }
        .print-btn { background: #dcfce7; color: #166534; }
        
        .empty-history {
            text-align: center; padding: 40px; color: #9ca3af; font-style: italic;
        }
        .history-count {
            font-size: 0.85rem; color: #6b7280; margin-top: 10px;
        }

        /* --- Footer --- */
        .app-footer { text-align: center; margin-top: 40px; padding: 20px; color: #6b7280; font-size: 0.9rem; border-top: 1px solid #e5e7eb; }
        .screen-only { display: block; }
        .print-only { display: none; }

        /* --- Print-Only Elements --- */
        .print-header {
            display: none;
        }

        @media (max-width: 768px) {
            .modal-content { width: 95%; margin: 10% auto; padding: 15px; }
            .result-header, .settings-grid { grid-template-columns: 1fr; }
            .stats-summary { grid-template-columns: repeat(2, 1fr); }
            .analysis-box > div { grid-template-columns: 1fr; }
            .history-table th, .history-table td { padding: 8px 10px; }
            .action-buttons { flex-direction: column; }
        }

        /* ========== PRINT STYLES ========== */
        @media print {
            @page {
                size: A4;
                margin: 2cm 2cm;
            }
            
            body {
                background: white !important;
                font-family: 'Sarabun', sans-serif;
                font-size: 11pt;
                line-height: 1.5;
                color: #000 !important;
                padding: 0 !important;
                margin: 0 !important;
            }
            
            /* ‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå */
            .screen-only,
            header,
            .btn-group,
            .app-footer,
            .modal,
            .test-buttons,
            .btn,
            .info-icon,
            .auto-recommendation,
            .critical-value-display,
            #warningMessage,
            .add-btn,
            .tag-container,
            .history-section,
            .history-controls,
            .history-table-container {
                display: none !important;
            }
            
            /* ‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå */
            .print-only {
                display: block !important;
            }
            
            .print-header {
                display: block;
                text-align: center;
                margin-bottom: 30px;
                padding-bottom: 20px;
                border-bottom: 3px double #000;
            }
            
            .print-header h1 {
                font-family: 'Prompt', sans-serif;
                font-size: 20pt;
                color: #000;
                margin-bottom: 8px;
            }
            
            .print-header .subtitle {
                font-size: 11pt;
                color: #666;
                font-family: 'Prompt', sans-serif;
                font-weight: 500;
            }
            
            .print-meta {
                display: flex;
                justify-content: space-between;
                font-size: 10pt;
                color: #666;
                margin-bottom: 25px;
                padding-bottom: 15px;
                border-bottom: 1px solid #ddd;
            }
            
            .print-report-title {
                text-align: center;
                font-family: 'Prompt', sans-serif;
                font-size: 16pt;
                margin: 25px 0;
                padding: 10px;
                background: #f5f5f5;
                border: 1px solid #000;
            }
            
            /* ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ç‡∏≠‡∏á container */
            .container {
                max-width: 100% !important;
                padding: 0 !important;
                margin: 0 !important;
            }
            
            .card {
                box-shadow: none !important;
                border: 1px solid #000 !important;
                border-radius: 0 !important;
                padding: 25px !important;
                margin-bottom: 25px !important;
                page-break-inside: avoid;
            }
            
            .section-title {
                font-family: 'Prompt', sans-serif;
                font-size: 13pt;
                color: #000 !important;
                border-bottom: 2px solid #000 !important;
                padding-bottom: 8px;
                margin-bottom: 20px;
                font-weight: 600;
            }
            
            /* ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå */
            .result-section {
                display: block !important;
                animation: none !important;
            }
            
            .result-header {
                grid-template-columns: 1fr 1fr;
                gap: 20px;
                margin-bottom: 20px;
            }
            
            .p-value-card, .ci-card {
                border: 2px solid #000 !important;
                padding: 20px !important;
                border-radius: 0 !important;
            }
            
            .display-val {
                font-size: 18pt !important;
            }
            
            .stats-summary {
                display: grid !important;
                grid-template-columns: repeat(4, 1fr) !important;
                gap: 15px;
                margin-bottom: 20px;
            }
            
            .stat-item {
                border: 1px solid #000 !important;
                padding: 15px !important;
                background: #fff !important;
            }
            
            .stat-lbl {
                font-size: 9pt !important;
            }
            
            .stat-val {
                font-size: 14pt !important;
            }
            
            .analysis-box {
                border: 2px solid #000 !important;
                border-left: 8px solid #000 !important;
                padding: 20px !important;
                margin-top: 20px !important;
                box-shadow: none !important;
            }
            
            .h-badge {
                padding: 6px 15px !important;
                font-size: 10pt !important;
                border: 1px solid #000 !important;
            }
            
            /* ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå */
            .print-table {
                width: 100%;
                border-collapse: collapse;
                margin: 20px 0;
                font-size: 10pt;
                border: 2px solid #000;
            }
            
            .print-table th {
                background: #f0f0f0;
                font-weight: bold;
                text-align: center;
                padding: 12px 8px;
                border: 1px solid #000;
                font-family: 'Prompt', sans-serif;
            }
            
            .print-table td {
                padding: 10px 8px;
                border: 1px solid #000;
                text-align: center;
            }
            
            /* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏ô‡∏†‡∏≤‡∏û */
            .results-table {
                width: 100%;
                border-collapse: collapse;
                margin: 25px 0;
                font-size: 10pt;
                border: 2px solid #000;
            }
            
            .results-table th {
                background: #e0e0e0;
                font-weight: bold;
                padding: 12px;
                border: 1px solid #000;
                text-align: center;
                font-family: 'Prompt', sans-serif;
            }
            
            .results-table td {
                padding: 10px;
                border: 1px solid #000;
                text-align: center;
            }
            
            /* ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ */
            .project-info-print {
                margin-bottom: 25px;
                padding-bottom: 15px;
                border-bottom: 1px solid #ddd;
            }
            
            .project-info-print p {
                margin: 5px 0;
                font-size: 11pt;
                line-height: 1.6;
            }
            
            /* ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö */
            .test-data-print {
                background: #f9f9f9;
                padding: 20px;
                margin: 20px 0;
                border: 1px solid #ddd;
            }
            
            .test-data-print h4 {
                margin-top: 0;
                margin-bottom: 15px;
                font-family: 'Prompt', sans-serif;
                font-size: 12pt;
            }
            
            /* ‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏ï‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏ô‡∏†‡∏≤‡∏û */
            .conclusion-section {
                margin-top: 30px;
                padding: 20px;
                border: 2px solid #000;
                background: #f9f9f9;
                page-break-inside: avoid;
            }
            
            .conclusion-section h3 {
                font-family: 'Prompt', sans-serif;
                font-size: 12pt;
                margin-top: 0;
                margin-bottom: 15px;
                color: #000;
            }
            
            .conclusion-text {
                font-size: 11pt;
                line-height: 1.6;
                margin-bottom: 20px;
            }
            
            .signature-section {
                margin-top: 50px;
                text-align: center;
                page-break-inside: avoid;
            }
            
            .signature-line {
                display: inline-block;
                width: 300px;
                border-top: 1px solid #000;
                margin-top: 40px;
                padding-top: 10px;
                font-size: 11pt;
            }
            
            /* ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏≤‡∏î‡∏Å‡∏•‡∏≤‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ */
            h2, h3, h4 {
                page-break-after: avoid;
            }
            
            .card, .analysis-box, .result-header, .conclusion-section {
                page-break-inside: avoid;
            }
            
            /* Footer ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏û‡∏à */
            .page-footer {
                text-align: center;
                font-size: 9pt;
                color: #666;
                margin-top: 30px;
                padding-top: 15px;
                border-top: 1px solid #ddd;
                position: fixed;
                bottom: 0;
                width: 100%;
            }
            
            .page-number:after {
                content: "‡∏´‡∏ô‡πâ‡∏≤ " counter(page);
            }
        }
    </style>
</head>
<body>

<div class="container">
    
    <header class="screen-only">
        <h1 class="main-title"><i class="ph ph-stethoscope"></i> Research Statistics Tool</h1>
        <div class="subtitle">‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏™‡∏∏‡∏Ç (v5.6 Methodology Ed.)</div>
    </header>

    <div class="card screen-only" style="padding: 15px;">
        <div class="test-buttons" style="margin:0;">
            <button class="test-btn active" onclick="selectTest('two-sample')" data-test="two-sample">Independent t-test</button>
            <button class="test-btn" onclick="selectTest('one-sample')" data-test="one-sample">One-Sample t-test</button>
            <button class="test-btn" onclick="selectTest('proportion')" data-test="proportion">Proportion Z-Test</button>
        </div>
    </div>

    <div class="card screen-only">
        <div class="section-title"><i class="ph ph-folder-user"></i> 1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢ (Project Info)</div>
        <input type="hidden" id="editId">
        <div class="form-grid">
            <div class="form-group"><label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏´‡∏•‡∏±‡∏Å (PI)</label><input type="text" id="piName"></div>
            <div class="form-group"><label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ß‡∏¥‡∏à‡∏±‡∏¢ (Title)</label><input type="text" id="titleName"></div>
        </div>
        <div class="form-group">
            <label>‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡∏ß‡∏¥‡∏à‡∏±‡∏¢</label>
            <div class="co-input-wrapper">
                <input type="text" id="coInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° +" onkeypress="handleCoKey(event)">
                <button type="button" class="add-btn" onclick="addCoResearcher()"><i class="ph ph-plus"></i></button>
            </div>
            <div id="coContainer" class="tag-container"></div>
        </div>

        <div style="height: 1px; background: #e5e7eb; margin: 25px 0;"></div>

        <div class="section-title">
            <i class="ph ph-sliders-horizontal"></i> 2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì (Settings)
            <button class="btn btn-edu" style="margin-left: auto; width: auto; font-size: 0.8rem; padding: 6px 15px;" onclick="openModal()">
                <i class="ph ph-book-open"></i> ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏™‡∏π‡∏ï‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢ (Methodology)
            </button>
        </div>
        
        <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: CI Setting ‡πÉ‡∏´‡∏°‡πà -->
        <div class="settings-grid">
            <div class="setting-card">
                <div style="font-weight:600; margin-bottom:10px; color:var(--primary);">Confidence Level</div>
                <label style="font-size:0.85rem;">Select Confidence Level</label>
                <select id="confidenceLevel" onchange="updateZValueDisplay(); updateAutoRecommendation();">
                    <option value="0.90">90% CI (Z=1.645)</option>
                    <option value="0.95" selected>95% CI (Z=1.96)</option>
                    <option value="0.99">99% CI (Z=2.576)</option>
                </select>
                <div style="font-size:0.75rem; color:#6b7280; margin-top:8px;" id="ciLevelInfo">
                    ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô: 95%
                </div>
            </div>
            
            <div class="setting-card">
                <div style="font-weight:600; margin-bottom:10px; color:var(--primary); display:flex; align-items:center; gap:5px;">
                    Critical Value Method
                    <i class="ph ph-info info-icon" onclick="showMethodInfo()"></i>
                </div>
                
                <!-- Radio buttons ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£ -->
                <div class="method-option">
                    <label class="method-label">
                        <input type="radio" name="methodChoice" id="autoMethod" value="auto" checked onclick="selectMethod('auto')">
                        <span style="font-weight:600;">Auto-Select (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)</span>
                        <i class="ph ph-info info-icon" onclick="showTooltip('auto')"></i>
                    </label>
                    <div id="autoRecommendation" class="auto-recommendation" style="display:none;">
                        <span id="autoRecommendationText">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</span>
                    </div>
                </div>
                
                <div class="method-option">
                    <label class="method-label">
                        <input type="radio" name="methodChoice" id="zMethod" value="z" onclick="selectMethod('z')">
                        <span>Z-Distribution <span id="zValueDisplay">(1.96)</span></span>
                        <i class="ph ph-info info-icon" onclick="showTooltip('z')"></i>
                    </label>
                </div>
                
                <div class="method-option">
                    <label class="method-label">
                        <input type="radio" name="methodChoice" id="tMethod" value="t" onclick="selectMethod('t')">
                        <span>T-Distribution (df-based)</span>
                        <i class="ph ph-info info-icon" onclick="showTooltip('t')"></i>
                    </label>
                </div>
                
                <!-- ‡πÅ‡∏™‡∏î‡∏á critical value ‡∏à‡∏£‡∏¥‡∏á -->
                <div class="critical-value-display" id="criticalValueDisplay" style="display:none;">
                    <div style="display:flex; justify-content:space-between; font-size:0.85rem;">
                        <span style="font-weight:600;">Critical Value:</span>
                        <span id="critValueText">--</span>
                    </div>
                </div>
                
                <!-- ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö n < 30 -->
                <div id="warningMessage" style="display:none; margin-top:10px; padding:10px; background:#fef2f2; border-radius:8px; border-left:4px solid #ef4444;">
                    <div style="display:flex; align-items:center; gap:8px;">
                        <i class="ph ph-warning" style="color:#ef4444;"></i>
                        <span style="font-size:0.85rem; font-weight:600;">‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: Z-Distribution ‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö n < 30 ‚Äî ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏ä‡πâ T-Distribution</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="group-box" style="background:#f8fafc; padding:15px; border-radius:12px;">
            <div id="twoSampleInput">
                <div class="form-grid">
                    <div style="background:#eef2ff; padding:15px; border-radius:12px; border:1px solid #c7d2fe;">
                        <strong style="color:#4f46e5; display:block; margin-bottom:10px;">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏î‡∏•‡∏≠‡∏á (Exp)</strong>
                        <div class="form-group"><label>Mean</label><input type="number" step="any" id="m1"></div>
                        <div class="form-group"><label>SD</label><input type="number" step="any" id="sd1"></div>
                        <div class="form-group"><label>n</label><input type="number" id="n1" oninput="updateAutoRecommendation(); checkZWarning();"></div>
                    </div>
                    <div style="background:#f3f4f6; padding:15px; border-radius:12px; border:1px solid #d1d5db;">
                        <strong style="color:#374151; display:block; margin-bottom:10px;">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° (Ctrl)</strong>
                        <div class="form-group"><label>Mean</label><input type="number" step="any" id="m2"></div>
                        <div class="form-group"><label>SD</label><input type="number" step="any" id="sd2"></div>
                        <div class="form-group"><label>n</label><input type="number" id="n2" oninput="updateAutoRecommendation(); checkZWarning();"></div>
                    </div>
                </div>
            </div>
            <div id="oneSampleInput" style="display:none;">
                <div class="form-grid">
                    <div style="background:#eef2ff; padding:15px; border-radius:12px; border:1px solid #c7d2fe;">
                        <strong style="color:#4f46e5; display:block; margin-bottom:10px;">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</strong>
                        <div class="form-group"><label>Mean</label><input type="number" step="any" id="mOne" oninput="updateAutoRecommendation(); checkZWarning();"></div>
                        <div class="form-group"><label>SD</label><input type="number" step="any" id="sdOne"></div>
                        <div class="form-group"><label>n</label><input type="number" id="nOne"></div>
                    </div>
                    <div style="background:#f3f4f6; padding:15px; border-radius:12px; border:1px solid #d1d5db;">
                        <strong style="color:#374151; display:block; margin-bottom:10px;">Population</strong>
                        <div class="form-group"><label>Mean ($\mu_0$)</label><input type="number" step="any" id="mu0"></div>
                    </div>
                </div>
            </div>
            <div id="proportionInput" style="display:none;">
                <div class="form-grid">
                    <div style="background:#eef2ff; padding:15px; border-radius:12px; border:1px solid #c7d2fe;">
                        <strong style="color:#4f46e5; display:block; margin-bottom:10px;">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà 1</strong>
                        <div class="form-group"><label>Events (x‚ÇÅ)</label><input type="number" id="xP1"></div>
                        <div class="form-group"><label>Total (n‚ÇÅ)</label><input type="number" id="nP1" oninput="updateAutoRecommendation(); checkZWarning();"></div>
                    </div>
                    <div style="background:#f3f4f6; padding:15px; border-radius:12px; border:1px solid #d1d5db;">
                        <strong style="color:#374151; display:block; margin-bottom:10px;">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà 2</strong>
                        <div class="form-group"><label>Events (x‚ÇÇ)</label><input type="number" id="xP2"></div>
                        <div class="form-group"><label>Total (n‚ÇÇ)</label><input type="number" id="nP2" oninput="updateAutoRecommendation(); checkZWarning();"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="btn-group">
            <button class="btn btn-outline" onclick="resetForm()"><i class="ph ph-eraser"></i> ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤</button>
            <button class="btn btn-primary" onclick="calculateStats()"><i class="ph ph-calculator"></i> ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</button>
        </div>
    </div>

    <!-- Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏™‡∏π‡∏ï‡∏£ -->
    <div id="eduModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="font-family:'Prompt'; color:var(--primary);"><i class="ph ph-books"></i> ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏π‡∏ï‡∏£‡πÅ‡∏•‡∏∞‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏ó‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</h2>
                <span class="close-modal" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body">
                <p>WebApp ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô 5.6 ‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏ô‡∏¥‡∏û‡∏ô‡∏ò‡πå (‡∏ö‡∏ó‡∏ó‡∏µ‡πà 3) ‡πÅ‡∏•‡∏∞‡∏†‡∏≤‡∏Ñ‡∏ú‡∏ô‡∏ß‡∏Å ‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:</p>
                <hr style="margin:15px 0; opacity:0.2;">
                
                <h3>1. ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ 2 ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏¥‡∏™‡∏£‡∏∞ (Independent Samples t-test)</h3>
                <p>‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ô‡∏µ‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡∏™‡∏π‡∏ï‡∏£ <strong>Welch's t-test (Unpooled variances)</strong> ‡∏ã‡∏∂‡πà‡∏á‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠ SD ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô</p>
                <div class="formula-box">$$t = \frac{\bar{X}_1 - \bar{X}_2}{\sqrt{ \frac{s_1^2}{n_1} + \frac{s_2^2}{n_2} }}$$</div>
                <p>‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ df ‡πÉ‡∏ä‡πâ‡∏™‡∏π‡∏ï‡∏£ <strong>Welch‚ÄìSatterthwaite equation</strong>:</p>
                <div class="formula-box">$$df = \frac{ \left( \frac{s_1^2}{n_1} + \frac{s_2^2}{n_2} \right)^2 }{ \frac{ \left( \frac{s_1^2}{n_1} \right)^2 }{n_1 - 1} + \frac{ \left( \frac{s_2^2}{n_2} \right)^2 }{n_2 - 1} }$$</div>
                

                <h3>2. ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (One-Sample t-test)</h3>
                <div class="formula-box">$$t = \frac{\bar{X} - \mu_0}{s / \sqrt{n}}$$</div>
                <p>‡πÇ‡∏î‡∏¢‡∏ó‡∏µ‡πà $df = n - 1$</p>

                <h3>3. ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô 2 ‡∏Å‡∏•‡∏∏‡πà‡∏° (Two-Proportion Z-Test)</h3>
                <div class="formula-box">$$Z = \frac{\hat{p}_1 - \hat{p}_2}{\sqrt{ \hat{p}(1-\hat{p}) \left( \frac{1}{n_1} + \frac{1}{n_2} \right) }}$$</div>

                <h3>4. ‡∏ä‡πà‡∏ß‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô (Confidence Interval: CI)</h3>
                <div class="formula-box">$$CI = \text{Point Estimate} \pm (\text{Critical Value} \times \text{Standard Error})$$</div>
                

                <h3>5. ‡∏Ç‡∏ô‡∏≤‡∏î‡∏≠‡∏¥‡∏ó‡∏ò‡∏¥‡∏û‡∏• (Effect Size: Cohen's d)</h3>
                <p>‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á Cohen (1988) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á:</p>
                <div class="formula-box">$$d = \frac{\bar{X}_1 - \bar{X}_2}{SD_{pooled}}$$</div>
                <ul style="margin-left:25px;">
                    <li>$d < 0.2$: ‡∏ï‡πà‡∏≥‡∏°‡∏≤‡∏Å (Negligible)</li>
                    <li>$0.2 - 0.5$: ‡∏ï‡πà‡∏≥ (Small)</li>
                    <li>$0.5 - 0.8$: ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (Medium)</li>
                    <li>$d \ge 0.8$: ‡∏™‡∏π‡∏á (Large)</li>
                </ul>

                <div style="background:#f1f5f9; padding:20px; border-radius:12px; margin-top:20px;">
                    <strong>üìù ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á (References):</strong><br>
                    <small>
                        ‚Ä¢ Welch, B. L. (1947). "The generalization of Student's problem...". Biometrika.<br>
                        ‚Ä¢ Cohen, J. (1988). Statistical Power Analysis for the Behavioral Sciences.<br>
                        ‚Ä¢ Altman, D. G., et al. (2000). Statistics with Confidence. BMJ Books.
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£ -->
    <div id="methodInfoModal" class="modal">
        <div class="modal-content" style="max-width:700px;">
            <div class="modal-header">
                <h2 style="font-family:'Prompt'; color:var(--primary);"><i class="ph ph-info"></i> ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Critical Value</h2>
                <span class="close-modal" onclick="closeMethodModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="methodInfoContent">
                    <!-- ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å -->
                </div>
            </div>
        </div>
    </div>

    <div id="resultSection" class="card result-section screen-only">
        <div class="section-title"><i class="ph ph-chart-pie-slice"></i> 3. ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (Results)</div>
        <div class="result-header">
            <div id="pValueCard" class="p-value-card ns">
                <div style="font-size:0.85rem; font-weight:600; color:#666;">P-VALUE</div>
                <div class="display-val" id="pValueDisplay">--</div>
                <div id="pInterpretation" style="font-weight:500;">--</div>
            </div>
            <div class="ci-card">
                <div style="font-size:0.85rem; font-weight:600; color:#666;"><span id="ciLabel">95%</span> CONFIDENCE INTERVAL</div>
                <div class="display-val" id="ciDisplay" style="color:var(--primary);">--</div>
                <div id="ciMethodUsed" style="font-size:0.8rem; color:#666;">--</div>
            </div>
        </div>
        <div class="stats-summary">
            <div class="stat-item"><div class="stat-lbl">Statistic</div><div class="stat-val" id="testStatDisplay">--</div></div>
            <div class="stat-item"><div class="stat-lbl">df</div><div class="stat-val" id="dfDisplay">--</div></div>
            <div class="stat-item"><div class="stat-lbl">Effect Size (d)</div><div class="stat-val" id="effectSizeDisplay">--</div></div>
            <div class="stat-item"><div class="stat-lbl">Mean Diff</div><div class="stat-val" id="meanDiffDisplay">--</div></div>
        </div>
        <div class="analysis-box">
            <div id="hypoBadge" class="h-badge">--</div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                <div>
                    <div style="font-size:0.9rem; color:#64748b; font-weight:600;">Effect Size Summary:</div>
                    <div style="font-size:1.4rem; font-weight:700;"><span id="esValBox">--</span> <small id="esInterpBox" style="font-size:0.8rem; font-weight:normal;">--</small></div>
                </div>
                <div>
                    <div style="font-size:0.9rem; color:#64748b; font-weight:600;">Statistical Conclusion:</div>
                    <div id="thesisText" style="font-size:0.95rem; font-style:italic;">--</div>
                </div>
            </div>
        </div>
        <div class="btn-group">
            <button id="btnSave" class="btn btn-save" onclick="saveData()"><i class="ph ph-floppy-disk"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            <button class="btn btn-print" onclick="printReport()"><i class="ph ph-printer"></i> ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô PDF</button>
        </div>
    </div>

    <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì -->
    <div class="card screen-only history-section">
        <div class="section-title"><i class="ph ph-clock-counter-clockwise"></i> 4. ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì (Calculation History)</div>
        
        <div class="history-controls">
            <input type="text" class="history-search" id="historySearch" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£, ‡∏ú‡∏π‡πâ‡∏ß‡∏¥‡∏à‡∏±‡∏¢, ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö..." onkeyup="searchHistory()">
            <button class="clear-history-btn" onclick="clearHistory()"><i class="ph ph-trash"></i> ‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
        </div>
        
        <div class="history-table-container">
            <table class="history-table" id="historyTable">
                <thead>
                    <tr>
                        <th style="width: 180px;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà/‡πÄ‡∏ß‡∏•‡∏≤</th>
                        <th style="width: 200px;">‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</th>
                        <th style="width: 150px;">‡∏ú‡∏π‡πâ‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏´‡∏•‡∏±‡∏Å</th>
                        <th style="width: 120px;">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                        <th style="width: 100px;">P-Value</th>
                        <th style="width: 150px;">‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</th>
                        <th style="width: 120px;">‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                <tbody id="historyTableBody">
                    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏î‡∏¢ JavaScript -->
                </tbody>
            </table>
        </div>
        
        <div id="emptyHistory" class="empty-history" style="display: none;">
            <i class="ph ph-clock" style="font-size: 3rem; color: #d1d5db; margin-bottom: 15px;"></i>
            <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</p>
            <p style="font-size: 0.9rem; margin-top: 10px;">‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
        </div>
        
        <div class="history-count" id="historyCount">‡∏û‡∏ö 0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
    </div>

    <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå -->
    <div class="print-only" id="printContent">
        <div class="print-header">
            <h1><i class="ph ph-stethoscope"></i> Research Statistics Tool</h1>
            <div class="subtitle">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ß‡∏¥‡∏à‡∏±‡∏¢ (v5.6 Methodology Ed.)</div>
        </div>
        
        <div class="print-meta">
            <div>‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠: <span id="printDate"></span></div>
            <div>‡∏ú‡∏π‡πâ‡∏û‡∏¥‡∏°‡∏û‡πå: <span id="printUser"></span></div>
        </div>
        
        <div class="print-report-title">
            ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥<br>
            Statistical Analysis Report (Nursing Research)
        </div>
        
        <div class="card">
            <div class="section-title">1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</div>
            <div class="project-info-print" id="projectInfoPrint">
                <p><strong>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á:</strong> <span id="printTitle">--</span></p>
                <p><strong>‡∏ú‡∏π‡πâ‡∏ß‡∏¥‡∏à‡∏±‡∏¢:</strong> <span id="printPI">--</span></p>
                <p><strong>‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°:</strong> <span id="printCoResearchers">--</span></p>
                <p><strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</strong> <span id="printTestType">--</span></p>
                <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:</strong> <span id="printAnalysisDate">--</span></p>
            </div>
            
            <div class="section-title">2. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</div>
            <div id="testDataPrint"></div>
            
            <div class="section-title">3. ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (Results)</div>
            
            <table class="results-table">
                <thead>
                    <tr>
                        <th>Test</th>
                        <th>Statistic</th>
                        <th>df</th>
                        <th>P-value</th>
                        <th>Effect Size</th>
                        <th id="printCiHeader">95% CI</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td id="printTestName">--</td>
                        <td id="printTestStat">--</td>
                        <td id="printDf">--</td>
                        <td id="printPValue">--</td>
                        <td id="printEffectSize">--</td>
                        <td id="printCi">--</td>
                    </tr>
                </tbody>
            </table>
            
            <div class="analysis-box">
                <div id="printHypoBadge" class="h-badge">--</div>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                    <div>
                        <div style="font-size:0.9rem; color:#64748b; font-weight:600;">Effect Size Summary:</div>
                        <div style="font-size:1.4rem; font-weight:700;"><span id="printEsValBox">--</span> <small id="printEsInterpBox" style="font-size:0.8rem; font-weight:normal;">--</small></div>
                    </div>
                    <div>
                        <div style="font-size:0.9rem; color:#64748b; font-weight:600;">Statistical Conclusion:</div>
                        <div id="printThesisText" style="font-size:0.95rem; font-style:italic;">--</div>
                    </div>
                </div>
            </div>
            
            <div class="conclusion-section">
                <h3>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏• (Conclusion):</h3>
                <div class="conclusion-text" id="printConclusionText">
                    -- ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢ Independent t-test ‡∏û‡∏ö‡∏ß‡πà‡∏≤...
                </div>
                
                <div class="signature-section">
                    <div class="signature-line">
                        ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠ ‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶<br>
                        ( ‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶ )<br>
                        ‡∏ú‡∏π‡πâ‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏´‡∏•‡∏±‡∏Å
                    </div>
                </div>
            </div>
            
            <div class="section-title">4. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</div>
            <table class="print-table">
                <thead>
                    <tr>
                        <th>‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</th>
                        <th>‡∏Ñ‡πà‡∏≤</th>
                        <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                    </tr>
                </thead>
                <tbody id="printSettingsTable">
                    <tr>
                        <td>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô</td>
                        <td>95%</td>
                        <td>‡∏Ñ‡πà‡∏≤ Alpha = 0.05</td>
                    </tr>
                    <tr>
                        <td>‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</td>
                        <td>Auto-Select</td>
                        <td>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</td>
                    </tr>
                </tbody>
            </table>
            
            <div class="page-footer">
                <p>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å Research Statistics Tool v5.6 | ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢ ‡∏û‡∏ß.‡∏ß‡∏¥‡∏©‡∏ì‡∏∏‡∏Å‡∏£‡∏ì‡πå ‡πÇ‡∏≠‡∏¢‡∏≤ (Specialist Nurse) | ¬© 2026</p>
                <div class="page-number"></div>
            </div>
        </div>
    </div>

    <footer class="app-footer screen-only">
        <div>Developed by <b>‡∏û‡∏ß.‡∏ß‡∏¥‡∏©‡∏ì‡∏∏‡∏Å‡∏£‡∏ì‡πå ‡πÇ‡∏≠‡∏¢‡∏≤</b> (Specialist Nurse) <br> Research Tool v5.6 ¬© 2026</div>
        <div class="counter-box">
            <img src="https://counter1.optistats.ovh/private/freecounterstat.php?c=b753ph56wpe7h25hdftkulcnu1n4d5mu" border="0">
        </div>
    </footer>
</div>

<script>
    // --- Modal Logic ---
    function openModal() { 
        document.getElementById('eduModal').style.display = 'block'; 
        if(window.MathJax) MathJax.typeset();
    }
    function closeModal() { document.getElementById('eduModal').style.display = 'none'; }
    
    function closeMethodModal() { 
        document.getElementById('methodInfoModal').style.display = 'none'; 
    }
    
    window.onclick = function(event) {
        if (event.target == document.getElementById('eduModal')) closeModal();
        if (event.target == document.getElementById('methodInfoModal')) closeMethodModal();
    }

    // --- Core Logic (v5.6 Complete) ---
    let researchData = JSON.parse(localStorage.getItem('researchData')) || [];
    let coResearchers = [];
    let currentTestType = 'two-sample';
    let currentMethod = 'auto'; // 'auto', 'z', ‡∏´‡∏£‡∏∑‡∏≠ 't'
    let lastCalculation = null;
    let isEditing = false;
    let currentEditId = null;

    // Critical values ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Z-distribution ‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô‡∏ï‡πà‡∏≤‡∏á‡πÜ
    const zCriticalValues = {
        0.90: 1.645,
        0.95: 1.96,
        0.99: 2.576
    };

    function handleCoKey(e) { if(e.key === 'Enter') addCoResearcher(); }
    function addCoResearcher() {
        const val = document.getElementById('coInput').value.trim();
        if(val && !coResearchers.includes(val)) { 
            coResearchers.push(val); 
            renderCoTags(); 
            document.getElementById('coInput').value = ''; 
        }
    }
    function removeCo(i) { coResearchers.splice(i, 1); renderCoTags(); }
    function renderCoTags() {
        const c = document.getElementById('coContainer'); c.innerHTML = '';
        coResearchers.forEach((n, i) => c.innerHTML += `<div class="tag">${n} <i class="ph ph-x" onclick="removeCo(${i})"></i></div>`);
    }

    function selectTest(type) {
        currentTestType = type;
        document.querySelectorAll('.test-btn').forEach(b => b.classList.toggle('active', b.dataset.test === type));
        document.getElementById('twoSampleInput').style.display = type === 'two-sample' ? 'block' : 'none';
        document.getElementById('oneSampleInput').style.display = type === 'one-sample' ? 'block' : 'none';
        document.getElementById('proportionInput').style.display = type === 'proportion' ? 'block' : 'none';
        document.getElementById('resultSection').style.display = 'none';
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö
        updateAutoRecommendation();
        checkZWarning();
    }

    // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö CI Setting ---
    function selectMethod(method) {
        currentMethod = method;
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
        updateMethodUI();
        updateZValueDisplay();
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
        updateAutoRecommendation();
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        checkZWarning();
        
        // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏´‡∏°‡πà
        if (document.getElementById('resultSection').style.display === 'block' && lastCalculation) {
            calculateStats();
        }
    }

    function updateZValueDisplay() {
        const confidenceLevel = parseFloat(document.getElementById('confidenceLevel').value);
        const zValue = zCriticalValues[confidenceLevel];
        document.getElementById('zValueDisplay').textContent = `(${zValue.toFixed(3)})`;
    }

    function updateMethodUI() {
        const autoRecDiv = document.getElementById('autoRecommendation');
        const critValueDiv = document.getElementById('criticalValueDisplay');
        
        if (currentMethod === 'auto') {
            autoRecDiv.style.display = 'block';
            critValueDiv.style.display = 'none';
        } else {
            autoRecDiv.style.display = 'none';
            critValueDiv.style.display = 'block';
        }
    }

    function updateAutoRecommendation() {
        const recText = document.getElementById('autoRecommendationText');
        
        if (currentMethod !== 'auto') return;
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        let n1, n2;
        
        if (currentTestType === 'two-sample') {
            n1 = parseFloat(document.getElementById('n1').value);
            n2 = parseFloat(document.getElementById('n2').value);
        } else if (currentTestType === 'one-sample') {
            n1 = parseFloat(document.getElementById('nOne').value);
            n2 = null;
        } else {
            n1 = parseFloat(document.getElementById('nP1').value);
            n2 = parseFloat(document.getElementById('nP2').value);
        }
        
        if (!isNaN(n1) && (n2 === null || !isNaN(n2))) {
            const totalN = n2 ? n1 + n2 : n1;
            const avgN = n2 ? (n1 + n2) / 2 : n1;
            
            let recommendation = "";
            if (avgN >= 30) {
                recommendation = `‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏ä‡πâ Z-Distribution ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ‚â• 30 (n=${avgN.toFixed(0)})`;
            } else {
                recommendation = `‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏ä‡πâ T-Distribution ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á < 30 (n=${avgN.toFixed(0)})`;
            }
            
            recText.textContent = recommendation;
        } else {
            recText.textContent = "‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
        }
    }

    function checkZWarning() {
        const warningDiv = document.getElementById('warningMessage');
        
        // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Z-Distribution ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        if (currentMethod !== 'z') {
            warningDiv.style.display = 'none';
            return;
        }
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
        let n1, n2;
        
        if (currentTestType === 'two-sample') {
            n1 = parseFloat(document.getElementById('n1').value);
            n2 = parseFloat(document.getElementById('n2').value);
        } else if (currentTestType === 'one-sample') {
            n1 = parseFloat(document.getElementById('nOne').value);
            n2 = null;
        } else {
            n1 = parseFloat(document.getElementById('nP1').value);
            n2 = parseFloat(document.getElementById('nP2').value);
        }
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡πâ‡∏≤ n < 30
        if ((!isNaN(n1) && n1 < 30) || (!isNaN(n2) && n2 < 30)) {
            warningDiv.style.display = 'block';
        } else {
            warningDiv.style.display = 'none';
        }
    }

    function getCriticalValue(df, confidenceLevel) {
        const method = getSelectedMethod();
        
        if (method === 'z') {
            // ‡πÉ‡∏ä‡πâ Z-distribution
            return zCriticalValues[confidenceLevel];
        } else {
            // ‡πÉ‡∏ä‡πâ T-distribution
            // ‡∏Ñ‡πà‡∏≤ t-critical ‡∏à‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á t-distribution (two-tailed)
            if (df <= 0) return zCriticalValues[confidenceLevel];
            
            // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö df ‡∏ô‡πâ‡∏≠‡∏¢ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤ t-critical ‡∏ó‡∏µ‡πà‡∏™‡∏π‡∏á‡∏Ç‡∏∂‡πâ‡∏ô
            let tCrit;
            if (confidenceLevel === 0.90) {
                if (df >= 120) tCrit = 1.645;
                else if (df >= 60) tCrit = 1.671;
                else if (df >= 40) tCrit = 1.684;
                else if (df >= 30) tCrit = 1.697;
                else if (df >= 20) tCrit = 1.725;
                else if (df >= 15) tCrit = 1.753;
                else if (df >= 10) tCrit = 1.812;
                else if (df >= 5) tCrit = 1.943;
                else tCrit = 2.015; // df = 1
            } else if (confidenceLevel === 0.95) {
                if (df >= 120) tCrit = 1.96;
                else if (df >= 60) tCrit = 2.000;
                else if (df >= 40) tCrit = 2.021;
                else if (df >= 30) tCrit = 2.042;
                else if (df >= 20) tCrit = 2.086;
                else if (df >= 15) tCrit = 2.131;
                else if (df >= 10) tCrit = 2.228;
                else if (df >= 5) tCrit = 2.571;
                else tCrit = 2.920; // df = 1
            } else if (confidenceLevel === 0.99) {
                if (df >= 120) tCrit = 2.576;
                else if (df >= 60) tCrit = 2.660;
                else if (df >= 40) tCrit = 2.704;
                else if (df >= 30) tCrit = 2.750;
                else if (df >= 20) tCrit = 2.845;
                else if (df >= 15) tCrit = 2.947;
                else if (df >= 10) tCrit = 3.169;
                else if (df >= 5) tCrit = 4.032;
                else tCrit = 4.303; // df = 1
            } else {
                tCrit = 1.96; // ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            }
            
            return tCrit;
        }
    }

    function getSelectedMethod() {
        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å auto ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        if (currentMethod === 'auto') {
            let n1, n2;
            
            if (currentTestType === 'two-sample') {
                n1 = parseFloat(document.getElementById('n1').value);
                n2 = parseFloat(document.getElementById('n2').value);
            } else if (currentTestType === 'one-sample') {
                n1 = parseFloat(document.getElementById('nOne').value);
                n2 = null;
            } else {
                n1 = parseFloat(document.getElementById('nP1').value);
                n2 = parseFloat(document.getElementById('nP2').value);
            }
            
            // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÉ‡∏ä‡πâ Z ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            if (isNaN(n1) || (n2 !== null && isNaN(n2))) {
                return 'z';
            }
            
            const avgN = n2 ? (n1 + n2) / 2 : n1;
            
            if (avgN >= 30) {
                return 'z';
            } else {
                return 't';
            }
        }
        
        return currentMethod;
    }

    function showMethodInfo() {
        const modal = document.getElementById('methodInfoModal');
        const content = document.getElementById('methodInfoContent');
        
        content.innerHTML = `
            <h3>‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Critical Value Method</h3>
            <p>‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ô‡∏µ‡πâ‡∏°‡∏µ 3 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ä‡πà‡∏ß‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô:</p>
            
            <div style="background:#f1f5f9; padding:15px; border-radius:8px; margin:15px 0;">
                <strong>1. Auto-Select (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)</strong>
                <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç:</p>
                <ul style="margin-left:20px; margin-top:8px;">
                    <li><strong>‡πÉ‡∏ä‡πâ Z-Distribution ‡πÄ‡∏°‡∏∑‡πà‡∏≠:</strong> ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ‚â• 30 ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏µ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡πÅ‡∏à‡∏Å‡πÅ‡∏à‡∏á‡∏õ‡∏Å‡∏ï‡∏¥</li>
                    <li><strong>‡πÉ‡∏ä‡πâ T-Distribution ‡πÄ‡∏°‡∏∑‡πà‡∏≠:</strong> ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á < 30 ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏Ñ‡πà‡∏≤ SD ‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£</li>
                </ul>
            </div>
            
            <div style="background:#f0f9ff; padding:15px; border-radius:8px; margin:15px 0;">
                <strong>2. Z-Distribution</strong>
                <p><strong>‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö:</strong></p>
                <ul style="margin-left:20px; margin-top:8px;">
                    <li>‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏´‡∏ç‡πà (n ‚â• 30)</li>
                    <li>‡∏£‡∏π‡πâ‡∏Ñ‡πà‡∏≤ SD ‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£</li>
                    <li>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏à‡∏Å‡πÅ‡∏à‡∏á‡∏õ‡∏Å‡∏ï‡∏¥ (Normal Distribution)</li>
                    <li>‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Ñ‡πà‡∏≤ (Approximation) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏´‡∏ç‡πà</li>
                </ul>
                <p><strong>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á:</strong> ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ Z-distribution ‡∏Å‡∏±‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏•‡πá‡∏Å (n < 30) ‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏ß‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô‡πÅ‡∏Ñ‡∏ö‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Ñ‡πà‡∏≤‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÑ‡∏î‡πâ</p>
            </div>
            
            <div style="background:#fef2f2; padding:15px; border-radius:8px; margin:15px 0;">
                <strong>3. T-Distribution</strong>
                <p><strong>‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö:</strong></p>
                <ul style="margin-left:20px; margin-top:8px;">
                    <li>‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏•‡πá‡∏Å (n < 30)</li>
                    <li>‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏Ñ‡πà‡∏≤ SD ‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£</li>
                    <li>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏µ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡∏Å‡πÅ‡∏à‡∏á‡∏õ‡∏Å‡∏ï‡∏¥</li>
                    <li>‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏™‡∏π‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏•‡πá‡∏Å</li>
                </ul>
                <p><strong>‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:</strong> T-distribution ‡∏°‡∏µ‡∏´‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏≤‡∏ß‡∏Å‡∏ß‡πà‡∏≤ Z-distribution ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏ß‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏Å‡∏±‡∏î</p>
            </div>
            
            <div style="background:#ecfdf5; padding:15px; border-radius:8px; margin-top:20px;">
                <strong>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏à‡∏±‡∏¢:</strong>
                <p>‚Ä¢ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏ñ‡∏∂‡∏á‡πÄ‡∏•‡πá‡∏Å (n < 100) ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ <strong>T-Distribution</strong> ‡∏´‡∏£‡∏∑‡∏≠ <strong>Auto-Select</strong></p>
                <p>‚Ä¢ ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ Z-distribution ‡∏Å‡∏±‡∏ö n < 30 ‡∏≠‡∏≤‡∏à‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏à‡∏≤‡∏Å‡∏ß‡∏≤‡∏£‡∏™‡∏≤‡∏£‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏ö‡∏≤‡∏á‡πÅ‡∏´‡πà‡∏á</p>
            </div>
        `;
        
        modal.style.display = 'block';
        if(window.MathJax) MathJax.typeset();
    }

    function showTooltip(method) {
        const modal = document.getElementById('methodInfoModal');
        const content = document.getElementById('methodInfoContent');
        
        if (method === 'auto') {
            content.innerHTML = `
                <h3>Auto-Select Mode</h3>
                <div style="background:#f1f5f9; padding:15px; border-radius:8px; margin:15px 0;">
                    <p><strong>‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:</strong> ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î:</p>
                    <ol style="margin-left:20px; margin-top:10px;">
                        <li><strong>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:</strong> 
                            <ul style="margin-left:15px; margin-top:5px;">
                                <li>‡∏ñ‡πâ‡∏≤ n ‚â• 30 ‚Üí ‡πÉ‡∏ä‡πâ Z-Distribution</li>
                                <li>‡∏ñ‡πâ‡∏≤ n < 30 ‚Üí ‡πÉ‡∏ä‡πâ T-Distribution</li>
                            </ul>
                        </li>
                        <li><strong>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:</strong> ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö One-Sample t-test ‡∏à‡∏∞‡πÉ‡∏ä‡πâ T-Distribution ‡πÄ‡∏™‡∏°‡∏≠‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏Ñ‡πà‡∏≤ SD ‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£</li>
                        <li><strong>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡∏Å‡πÅ‡∏à‡∏á‡∏õ‡∏Å‡∏ï‡∏¥:</strong> ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏ö‡πà‡∏á‡∏ä‡∏µ‡πâ‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏õ‡∏Å‡∏ï‡∏¥ ‚Üí ‡πÉ‡∏ä‡πâ T-Distribution</li>
                    </ol>
                </div>
                <p style="color:#475569; font-style:italic;">‡πÇ‡∏´‡∏°‡∏î‡∏ô‡∏µ‡πâ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏á‡∏ß‡∏•‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</p>
            `;
        } else if (method === 'z') {
            content.innerHTML = `
                <h3>Z-Distribution (‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡∏Å‡πÅ‡∏à‡∏á‡∏õ‡∏Å‡∏ï‡∏¥‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô)</h3>
                <div class="formula-box">$$Z \\sim N(0,1)$$</div>
                
                <p><strong>‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:</strong></p>
                <ul>
                    <li>‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏´‡∏ç‡πà (n ‚â• 30) - ‡∏ï‡∏≤‡∏° Central Limit Theorem</li>
                    <li>‡∏£‡∏π‡πâ‡∏Ñ‡πà‡∏≤ Standard Deviation ‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£ (œÉ)</li>
                    <li>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏à‡∏Å‡πÅ‡∏à‡∏á‡∏õ‡∏Å‡∏ï‡∏¥ ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏õ‡∏Å‡∏ï‡∏¥</li>
                    <li>‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Ñ‡πà‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ T ‡πÑ‡∏î‡πâ</li>
                </ul>
                
                <p><strong>Critical Values ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô:</strong></p>
                <table style="width:100%; border-collapse:collapse; margin:15px 0;">
                    <tr style="background:#f8fafc;">
                        <th style="padding:10px; text-align:left; border:1px solid #e2e8f0;">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô</th>
                        <th style="padding:10px; text-align:center; border:1px solid #e2e8f0;">Z-Value</th>
                    </tr>
                    <tr>
                        <td style="padding:10px; border:1px solid #e2e8f0;">90%</td>
                        <td style="padding:10px; text-align:center; border:1px solid #e2e8f0;">1.645</td>
                    </tr>
                    <tr style="background:#f8fafc;">
                        <td style="padding:10px; border:1px solid #e2e8f0;">95%</td>
                        <td style="padding:10px; text-align:center; border:1px solid #e2e8f0;">1.960</td>
                    </tr>
                    <tr>
                        <td style="padding:10px; border:1px solid #e2e8f0;">99%</td>
                        <td style="padding:10px; text-align:center; border:1px solid #e2e8f0;">2.576</td>
                    </tr>
                </table>
                
                <div style="background:#fef2f2; padding:12px; border-radius:8px; margin-top:15px;">
                    <strong><i class="ph ph-warning"></i> ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:</strong> ‡∏≠‡∏¢‡πà‡∏≤‡πÉ‡∏ä‡πâ Z-Distribution ‡πÄ‡∏°‡∏∑‡πà‡∏≠ n < 30 ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏ß‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô‡πÅ‡∏Ñ‡∏ö‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠
                </div>
            `;
        } else if (method === 't') {
            content.innerHTML = `
                <h3>T-Distribution (‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡∏Å‡πÅ‡∏à‡∏á‡∏Ç‡∏≠‡∏á Student's t)</h3>
                <div class="formula-box">$$t \\sim t_{df}$$</div>
                
                <p><strong>‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:</strong></p>
                <ul>
                    <li>‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏•‡πá‡∏Å (n < 30)</li>
                    <li>‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏Ñ‡πà‡∏≤ Standard Deviation ‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£</li>
                    <li>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏µ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡∏Å‡πÅ‡∏à‡∏á‡∏õ‡∏Å‡∏ï‡∏¥</li>
                    <li>‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏™‡∏π‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏•‡πá‡∏Å</li>
                </ul>
                
                <p><strong>‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:</strong></p>
                <ul>
                    <li>‡∏°‡∏µ‡∏´‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏≤‡∏ß‡∏Å‡∏ß‡πà‡∏≤ (heavy-tailed) ‡∏Å‡∏ß‡πà‡∏≤ Z-distribution</li>
                    <li>‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏≠‡∏¥‡∏™‡∏£‡∏∞ (degrees of freedom, df)</li>
                    <li>‡πÄ‡∏°‡∏∑‡πà‡∏≠ df ‚Üí ‚àû, t-distribution ‚Üí Z-distribution</li>
                </ul>
                
                <p><strong>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡πà‡∏≤ T-Critical (95% CI):</strong></p>
                <table style="width:100%; border-collapse:collapse; margin:15px 0;">
                    <tr style="background:#f8fafc;">
                        <th style="padding:10px; text-align:left; border:1px solid #e2e8f0;">Degrees of Freedom (df)</th>
                        <th style="padding:10px; text-align:center; border:1px solid #e2e8f0;">T-Value (95%)</th>
                    </tr>
                    <tr>
                        <td style="padding:10px; border:1px solid #e2e8f0;">1</td>
                        <td style="padding:10px; text-align:center; border:1px solid #e2e8f0;">12.706</td>
                    </tr>
                    <tr style="background:#f8fafc;">
                        <td style="padding:10px; border:1px solid #e2e8f0;">5</td>
                        <td style="padding:10px; text-align:center; border:1px solid #e2e8f0;">2.571</td>
                    </tr>
                    <tr>
                        <td style="padding:10px; border:1px solid #e2e8f0;">10</td>
                        <td style="padding:10px; text-align:center; border:1px solid #e2e8f0;">2.228</td>
                    </tr>
                    <tr style="background:#f8fafc;">
                        <td style="padding:10px; border:1px solid #e2e8f0;">30</td>
                        <td style="padding:10px; text-align:center; border:1px solid #e2e8f0;">2.042</td>
                    </tr>
                    <tr>
                        <td style="padding:10px; border:1px solid #e2e8f0;">120</td>
                        <td style="padding:10px; text-align:center; border:1px solid #e2e8f0;">1.980</td>
                    </tr>
                    <tr style="background:#f8fafc;">
                        <td style="padding:10px; border:1px solid #e2e8f0;">‚àû (Z)</td>
                        <td style="padding:10px; text-align:center; border:1px solid #e2e8f0;">1.960</td>
                    </tr>
                </table>
                
                <div style="background:#ecfdf5; padding:12px; border-radius:8px; margin-top:15px;">
                    <strong><i class="ph ph-check-circle"></i> ‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:</strong> ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÅ‡∏•‡∏∞‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏±‡∏Å‡∏°‡∏µ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å‡∏ñ‡∏∂‡∏á‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á
                </div>
            `;
        }
        
        modal.style.display = 'block';
        if(window.MathJax) MathJax.typeset();
    }

    // Statistical functions
    function normalCDF(z) {
        const t = 1 / (1 + 0.2316419 * Math.abs(z));
        const d = 0.3989423 * Math.exp(-z * z / 2);
        const p = d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))));
        return z > 0 ? 1 - p : p;
    }

    function calculateStats() {
        const confidenceLevel = parseFloat(document.getElementById('confidenceLevel').value);
        const method = getSelectedMethod();
        let res = {};

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô
        const ciLevel = Math.round(confidenceLevel * 100);
        document.getElementById('ciLabel').textContent = `${ciLevel}%`;
        document.getElementById('ciLevelInfo').textContent = `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô: ${ciLevel}%`;

        if(currentTestType === 'two-sample') {
            const m1=parseFloat(document.getElementById('m1').value), sd1=parseFloat(document.getElementById('sd1').value), n1=parseFloat(document.getElementById('n1').value);
            const m2=parseFloat(document.getElementById('m2').value), sd2=parseFloat(document.getElementById('sd2').value), n2=parseFloat(document.getElementById('n2').value);
            if(isNaN(n1) || isNaN(n2)) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö');
            const diff=m1-m2, se=Math.sqrt((sd1**2/n1)+(sd2**2/n2)), tStat=diff/se;
            const df=((sd1**2/n1)+(sd2**2/n2))**2 / (((sd1**2/n1)**2/(n1-1)) + ((sd2**2/n2)**2/(n2-1)));
            
            // ‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô getCriticalValue ‡πÉ‡∏´‡∏°‡πà
            const crit = getCriticalValue(df, confidenceLevel);
            
            // ‡πÅ‡∏™‡∏î‡∏á critical value ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ
            document.getElementById('critValueText').textContent = crit.toFixed(3);
            
            res = { 
                stat:tStat, 
                df:df, 
                p:2*(1-normalCDF(Math.abs(tStat))), 
                lower:diff-crit*se, 
                upper:diff+crit*se, 
                d:diff/Math.sqrt(((n1-1)*sd1**2+(n2-1)*sd2**2)/(n1+n2-2)), 
                diff:diff,
                crit: crit,
                testType: 'two-sample',
                data: { m1, sd1, n1, m2, sd2, n2 }
            };
        } else if(currentTestType === 'one-sample') {
            const m=parseFloat(document.getElementById('mOne').value), sd=parseFloat(document.getElementById('sdOne').value), n=parseFloat(document.getElementById('nOne').value), mu0=parseFloat(document.getElementById('mu0').value);
            if(isNaN(n)) return;
            const diff=m-mu0, se=sd/Math.sqrt(n), tStat=diff/se, df=n-1;
            
            // ‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô getCriticalValue ‡πÉ‡∏´‡∏°‡πà
            const crit = getCriticalValue(df, confidenceLevel);
            
            // ‡πÅ‡∏™‡∏î‡∏á critical value ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ
            document.getElementById('critValueText').textContent = crit.toFixed(3);
            
            res = { 
                stat:tStat, 
                df:df, 
                p:2*(1-normalCDF(Math.abs(tStat))), 
                lower:m-crit*se, 
                upper:m+crit*se, 
                d:diff/sd, 
                diff:diff,
                crit: crit,
                testType: 'one-sample',
                data: { m, sd, n, mu0 }
            };
        } else {
            const x1=parseFloat(document.getElementById('xP1').value), n1=parseFloat(document.getElementById('nP1').value), x2=parseFloat(document.getElementById('xP2').value), n2=parseFloat(document.getElementById('nP2').value);
            if(isNaN(n1)) return;
            const p1=x1/n1, p2=x2/n2, pp=(x1+x2)/(n1+n2), se=Math.sqrt(pp*(1-pp)*(1/n1+1/n2)), zStat=(p1-p2)/se;
            
            // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö proportion test ‡πÉ‡∏ä‡πâ Z-distribution ‡πÄ‡∏™‡∏°‡∏≠
            const crit = zCriticalValues[confidenceLevel];
            
            // ‡πÅ‡∏™‡∏î‡∏á critical value ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ
            document.getElementById('critValueText').textContent = crit.toFixed(3);
            
            res = { 
                stat:zStat, 
                df:0, 
                p:2*(1-normalCDF(Math.abs(zStat))), 
                lower:(p1-p2)-crit*se, 
                upper:(p1-p2)+crit*se, 
                d:0, 
                diff:p1-p2,
                crit: crit,
                testType: 'proportion',
                data: { x1, n1, x2, n2, p1, p2 }
            };
        }

        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
        lastCalculation = res;
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï method ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
        const methodUsed = getSelectedMethod();
        let methodText = '';
        if (methodUsed === 'z') {
            methodText = 'Z-Distribution';
        } else if (methodUsed === 't') {
            methodText = 'T-Distribution';
        } else {
            methodText = 'Auto-Selected';
        }
        document.getElementById('ciMethodUsed').textContent = `${methodText} | Critical Value = ${res.crit.toFixed(3)}`;

        displayResults(res, confidenceLevel, methodUsed);
    }

    function displayResults(res, confidenceLevel, method) {
        document.getElementById('resultSection').style.display = 'block';
        document.getElementById('pValueDisplay').innerText = res.p<0.001?'< .001':res.p.toFixed(3);
        const sig = res.p < (1 - confidenceLevel);
        document.getElementById('pValueCard').className = sig ? 'p-value-card sig' : 'p-value-card ns';
        document.getElementById('pInterpretation').innerText = sig ? 'Significant' : 'Not Significant';
        
        document.getElementById('ciDisplay').innerText = `[${res.lower.toFixed(2)}, ${res.upper.toFixed(2)}]`;
        
        document.getElementById('testStatDisplay').innerText = res.stat.toFixed(3);
        document.getElementById('dfDisplay').innerText = res.df ? res.df.toFixed(2) : '--';
        document.getElementById('effectSizeDisplay').innerText = res.d ? Math.abs(res.d).toFixed(2) : '-';
        document.getElementById('meanDiffDisplay').innerText = res.diff.toFixed(3);

        const badge = document.getElementById('hypoBadge');
        badge.innerText = sig ? 'Reject H‚ÇÄ / Accept H‚ÇÅ' : 'Accept H‚ÇÄ';
        badge.className = sig ? 'h-badge h-reject' : 'h-badge h-accept';

        let es = Math.abs(res.d || 0), interp = "Negligible";
        if(es >= 0.2) interp = "Small";
        if(es >= 0.5) interp = "Medium";
        if(es >= 0.8) interp = "Large";
        document.getElementById('esValBox').innerText = es.toFixed(2);
        document.getElementById('esInterpBox').innerText = interp;

        const ciLevel = Math.round(confidenceLevel * 100);
        document.getElementById('thesisText').innerText = `‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏ô‡∏±‡∏¢‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö ${ciLevel}% (p = ${res.p.toFixed(3)})`;
        document.getElementById('resultSection').scrollIntoView({behavior:'smooth'});
    }

    function resetForm() {
        document.querySelectorAll('input').forEach(i => i.value = '');
        coResearchers = []; renderCoTags();
        document.getElementById('resultSection').style.display = 'none';
        document.getElementById('warningMessage').style.display = 'none';
        document.getElementById('autoRecommendation').style.display = 'none';
        lastCalculation = null;
        isEditing = false;
        currentEditId = null;
        document.getElementById('editId').value = '';
        document.getElementById('btnSave').innerHTML = '<i class="ph ph-floppy-disk"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
        document.getElementById('btnSave').classList.remove('editing');
    }
    
    function saveData() { 
        if (!lastCalculation) {
            alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
            return;
        }
        
        const piName = document.getElementById('piName').value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠';
        const titleName = document.getElementById('titleName').value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á';
        const confidenceLevel = parseFloat(document.getElementById('confidenceLevel').value);
        const ciLevel = Math.round(confidenceLevel * 100);
        const sig = lastCalculation.p < (1 - confidenceLevel);
        
        const data = {
            id: isEditing ? currentEditId : Date.now(),
            piName: piName,
            titleName: titleName,
            coResearchers: [...coResearchers],
            testType: currentTestType,
            calculation: lastCalculation,
            confidenceLevel: confidenceLevel,
            method: getSelectedMethod(),
            timestamp: new Date().toLocaleString('th-TH'),
            date: new Date().toISOString().split('T')[0],
            result: sig ? 'Significant' : 'Not Significant'
        };
        
        if (isEditing) {
            // Update existing record
            const index = researchData.findIndex(item => item.id === currentEditId);
            if (index !== -1) {
                researchData[index] = data;
                alert('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
            }
            isEditing = false;
            currentEditId = null;
            document.getElementById('btnSave').innerHTML = '<i class="ph ph-floppy-disk"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
            document.getElementById('btnSave').classList.remove('editing');
        } else {
            // Add new record
            researchData.unshift(data);
            alert(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!\n‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£: ${titleName}\n‡∏ú‡∏π‡πâ‡∏ß‡∏¥‡∏à‡∏±‡∏¢: ${piName}`);
        }
        
        localStorage.setItem('researchData', JSON.stringify(researchData));
        loadHistory();
        resetForm();
    }

    // --- History Functions ---
    function loadHistory() {
        const tableBody = document.getElementById('historyTableBody');
        const emptyHistory = document.getElementById('emptyHistory');
        const historyCount = document.getElementById('historyCount');
        
        if (researchData.length === 0) {
            tableBody.innerHTML = '';
            emptyHistory.style.display = 'block';
            historyCount.textContent = '‡∏û‡∏ö 0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£';
            return;
        }
        
        emptyHistory.style.display = 'none';
        
        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ‡πÄ‡∏Å‡πà‡∏≤
        const sortedData = [...researchData].sort((a, b) => b.id - a.id);
        
        let html = '';
        sortedData.forEach(item => {
            const testTypeName = getTestTypeName(item.testType);
            const pValue = item.calculation.p < 0.001 ? '< .001' : item.calculation.p.toFixed(3);
            const resultClass = item.result === 'Significant' ? 'h-reject' : 'h-accept';
            const resultText = item.result === 'Significant' ? '‡∏°‡∏µ‡∏ô‡∏±‡∏¢‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç' : '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏¢‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç';
            
            html += `
                <tr data-id="${item.id}">
                    <td>${item.timestamp}</td>
                    <td><strong>${item.titleName}</strong></td>
                    <td>${item.piName}</td>
                    <td>${testTypeName}</td>
                    <td>${pValue}</td>
                    <td><span class="h-badge ${resultClass}" style="font-size:0.8rem; padding:3px 10px;">${resultText}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn view-btn" onclick="viewHistoryItem(${item.id})" title="‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">
                                <i class="ph ph-eye"></i>
                            </button>
                            <button class="action-btn edit-btn" onclick="editHistoryItem(${item.id})" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">
                                <i class="ph ph-pencil-simple"></i>
                            </button>
                            <button class="action-btn print-btn" onclick="printHistoryItem(${item.id})" title="‡∏û‡∏¥‡∏°‡∏û‡πå">
                                <i class="ph ph-printer"></i>
                            </button>
                            <button class="action-btn delete-btn" onclick="deleteHistoryItem(${item.id})" title="‡∏•‡∏ö">
                                <i class="ph ph-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        });
        
        tableBody.innerHTML = html;
        historyCount.textContent = `‡∏û‡∏ö ${researchData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
    }
    
    function searchHistory() {
        const searchTerm = document.getElementById('historySearch').value.toLowerCase();
        const rows = document.querySelectorAll('#historyTableBody tr');
        let visibleCount = 0;
        
        rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            if (text.includes(searchTerm)) {
                row.style.display = '';
                visibleCount++;
            } else {
                row.style.display = 'none';
            }
        });
        
        document.getElementById('historyCount').textContent = `‡∏û‡∏ö ${visibleCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
    }
    
    function clearHistory() {
        if (confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')) {
            researchData = [];
            localStorage.setItem('researchData', JSON.stringify(researchData));
            loadHistory();
            alert('‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
        }
    }
    
    function viewHistoryItem(id) {
        const item = researchData.find(item => item.id === id);
        if (!item) return;
        
        // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô modal
        const modal = document.getElementById('methodInfoModal');
        const content = document.getElementById('methodInfoContent');
        
        const confidenceLevel = item.confidenceLevel;
        const ciLevel = Math.round(confidenceLevel * 100);
        const sig = item.calculation.p < (1 - confidenceLevel);
        
        let dataDetails = '';
        if (item.testType === 'two-sample') {
            const d = item.calculation.data;
            dataDetails = `
                <div style="background:#f8fafc; padding:15px; border-radius:8px; margin:10px 0;">
                    <strong>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏î‡∏•‡∏≠‡∏á (Exp):</strong> Mean = ${d.m1}, SD = ${d.sd1}, n = ${d.n1}<br>
                    <strong>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° (Ctrl):</strong> Mean = ${d.m2}, SD = ${d.sd2}, n = ${d.n2}
                </div>
            `;
        } else if (item.testType === 'one-sample') {
            const d = item.calculation.data;
            dataDetails = `
                <div style="background:#f8fafc; padding:15px; border-radius:8px; margin:10px 0;">
                    <strong>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:</strong> Mean = ${d.m}, SD = ${d.sd}, n = ${d.n}<br>
                    <strong>‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£ (Œº‚ÇÄ):</strong> ${d.mu0}
                </div>
            `;
        } else {
            const d = item.calculation.data;
            dataDetails = `
                <div style="background:#f8fafc; padding:15px; border-radius:8px; margin:10px 0;">
                    <strong>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà 1:</strong> Events = ${d.x1}, Total = ${d.n1}, Proportion = ${d.p1.toFixed(3)}<br>
                    <strong>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà 2:</strong> Events = ${d.x2}, Total = ${d.n2}, Proportion = ${d.p2.toFixed(3)}
                </div>
            `;
        }
        
        content.innerHTML = `
            <h3>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</h3>
            <p><strong>‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£:</strong> ${item.titleName}</p>
            <p><strong>‡∏ú‡∏π‡πâ‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏´‡∏•‡∏±‡∏Å:</strong> ${item.piName}</p>
            <p><strong>‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡∏ß‡∏¥‡∏à‡∏±‡∏¢:</strong> ${item.coResearchers.join(', ') || '‡πÑ‡∏°‡πà‡∏°‡∏µ'}</p>
            <p><strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</strong> ${getTestTypeName(item.testType)}</p>
            <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì:</strong> ${item.timestamp}</p>
            
            ${dataDetails}
            
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin:15px 0;">
                <div style="background:#fff; padding:15px; border-radius:8px; border:1px solid #e2e8f0;">
                    <strong>P-Value</strong><br>
                    <span style="font-size:1.5rem; font-weight:bold;">${item.calculation.p < 0.001 ? '< .001' : item.calculation.p.toFixed(3)}</span>
                </div>
                <div style="background:#fff; padding:15px; border-radius:8px; border:1px solid #e2e8f0;">
                    <strong>${ciLevel}% CI</strong><br>
                    <span style="font-size:1.2rem; font-weight:bold;">[${item.calculation.lower.toFixed(2)}, ${item.calculation.upper.toFixed(2)}]</span>
                </div>
            </div>
            
            <div style="background:#f1f5f9; padding:15px; border-radius:8px; margin-top:15px;">
                <p><strong>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•:</strong> ${sig ? '‡∏°‡∏µ‡∏ô‡∏±‡∏¢‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥' : '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏¢‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥'} ‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö ${ciLevel}%</p>
                <p><strong>Effect Size (Cohen's d):</strong> ${item.calculation.d ? Math.abs(item.calculation.d).toFixed(2) : 'N/A'}</p>
            </div>
        `;
        
        modal.style.display = 'block';
    }
    
    function editHistoryItem(id) {
        const item = researchData.find(item => item.id === id);
        if (!item) return;
        
        // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
        document.getElementById('piName').value = item.piName;
        document.getElementById('titleName').value = item.titleName;
        coResearchers = [...item.coResearchers];
        renderCoTags();
        
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö
        selectTest(item.testType);
        
        // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö
        if (item.testType === 'two-sample') {
            const d = item.calculation.data;
            document.getElementById('m1').value = d.m1;
            document.getElementById('sd1').value = d.sd1;
            document.getElementById('n1').value = d.n1;
            document.getElementById('m2').value = d.m2;
            document.getElementById('sd2').value = d.sd2;
            document.getElementById('n2').value = d.n2;
        } else if (item.testType === 'one-sample') {
            const d = item.calculation.data;
            document.getElementById('mOne').value = d.m;
            document.getElementById('sdOne').value = d.sd;
            document.getElementById('nOne').value = d.n;
            document.getElementById('mu0').value = d.mu0;
        } else {
            const d = item.calculation.data;
            document.getElementById('xP1').value = d.x1;
            document.getElementById('nP1').value = d.n1;
            document.getElementById('xP2').value = d.x2;
            document.getElementById('nP2').value = d.n2;
        }
        
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ confidence level
        document.getElementById('confidenceLevel').value = item.confidenceLevel;
        updateZValueDisplay();
        
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ method
        currentMethod = item.method;
        document.getElementById(`${item.method}Method`).checked = true;
        selectMethod(item.method);
        
        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
        calculateStats();
        
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
        isEditing = true;
        currentEditId = item.id;
        document.getElementById('editId').value = item.id;
        document.getElementById('btnSave').innerHTML = '<i class="ph ph-floppy-disk"></i> ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
        document.getElementById('btnSave').classList.add('editing');
        
        // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏ô‡∏Ç‡∏≠‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
        document.querySelector('.card').scrollIntoView({behavior: 'smooth'});
    }
    
    function printHistoryItem(id) {
        const item = researchData.find(item => item.id === id);
        if (!item) return;
        
        // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå
        preparePrintDataForHistory(item);
        
        // ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå
        window.print();
    }
    
    function deleteHistoryItem(id) {
        if (confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?')) {
            researchData = researchData.filter(item => item.id !== id);
            localStorage.setItem('researchData', JSON.stringify(researchData));
            loadHistory();
            alert('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
        }
    }
    
    function preparePrintDataForHistory(item) {
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå
        const now = new Date();
        document.getElementById('printDate').textContent = now.toLocaleDateString('th-TH', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
        
        document.getElementById('printUser').textContent = item.piName;
        document.getElementById('printTitle').textContent = item.titleName;
        document.getElementById('printPI').textContent = item.piName;
        document.getElementById('printCoResearchers').textContent = item.coResearchers.join(', ') || '--';
        document.getElementById('printTestType').textContent = getTestTypeName(item.testType);
        document.getElementById('printAnalysisDate').textContent = item.timestamp;
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö
        let testDataHTML = '';
        if (item.testType === 'two-sample') {
            const d = item.calculation.data;
            testDataHTML = `
                <table class="print-table">
                    <thead>
                        <tr>
                            <th>‡∏Å‡∏•‡∏∏‡πà‡∏°</th>
                            <th>Mean</th>
                            <th>SD</th>
                            <th>n</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏î‡∏•‡∏≠‡∏á (Exp)</td>
                            <td>${d.m1}</td>
                            <td>${d.sd1}</td>
                            <td>${d.n1}</td>
                        </tr>
                        <tr>
                            <td>‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° (Ctrl)</td>
                            <td>${d.m2}</td>
                            <td>${d.sd2}</td>
                            <td>${d.n2}</td>
                        </tr>
                    </tbody>
                </table>
            `;
        } else if (item.testType === 'one-sample') {
            const d = item.calculation.data;
            testDataHTML = `
                <table class="print-table">
                    <thead>
                        <tr>
                            <th>‡∏Ñ‡πà‡∏≤‡∏ó‡∏î‡∏™‡∏≠‡∏ö</th>
                            <th>‡∏Ñ‡πà‡∏≤</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Mean ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</td>
                            <td>${d.m}</td>
                        </tr>
                        <tr>
                            <td>SD ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</td>
                            <td>${d.sd}</td>
                        </tr>
                        <tr>
                            <td>n</td>
                            <td>${d.n}</td>
                        </tr>
                        <tr>
                            <td>Mean ‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£ (Œº‚ÇÄ)</td>
                            <td>${d.mu0}</td>
                        </tr>
                    </tbody>
                </table>
            `;
        } else {
            const d = item.calculation.data;
            testDataHTML = `
                <table class="print-table">
                    <thead>
                        <tr>
                            <th>‡∏Å‡∏•‡∏∏‡πà‡∏°</th>
                            <th>Events (x)</th>
                            <th>Total (n)</th>
                            <th>Proportion (p)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà 1</td>
                            <td>${d.x1}</td>
                            <td>${d.n1}</td>
                            <td>${d.p1.toFixed(3)}</td>
                        </tr>
                        <tr>
                            <td>‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà 2</td>
                            <td>${d.x2}</td>
                            <td>${d.n2}</td>
                            <td>${d.p2.toFixed(3)}</td>
                        </tr>
                    </tbody>
                </table>
            `;
        }
        
        document.getElementById('testDataPrint').innerHTML = testDataHTML;
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå
        const confidenceLevel = item.confidenceLevel;
        const ciLevel = Math.round(confidenceLevel * 100);
        const sig = item.calculation.p < (1 - confidenceLevel);
        
        document.getElementById('printTestName').textContent = getTestTypeName(item.testType);
        document.getElementById('printTestStat').textContent = item.calculation.stat.toFixed(3);
        document.getElementById('printDf').textContent = item.calculation.df ? item.calculation.df.toFixed(2) : '--';
        document.getElementById('printPValue').textContent = item.calculation.p < 0.001 ? '< .001' : item.calculation.p.toFixed(3);
        document.getElementById('printEffectSize').textContent = item.calculation.d ? Math.abs(item.calculation.d).toFixed(2) : '--';
        document.getElementById('printCi').textContent = `[${item.calculation.lower.toFixed(2)}, ${item.calculation.upper.toFixed(2)}]`;
        document.getElementById('printCiHeader').textContent = `${ciLevel}% CI`;
        
        document.getElementById('printPValueDisplay').textContent = item.calculation.p < 0.001 ? '< .001' : item.calculation.p.toFixed(3);
        document.getElementById('printPValueCard').className = sig ? 'p-value-card sig' : 'p-value-card ns';
        document.getElementById('printPInterpretation').textContent = sig ? 'Significant' : 'Not Significant';
        
        document.getElementById('printCiDisplay').textContent = `[${item.calculation.lower.toFixed(2)}, ${item.calculation.upper.toFixed(2)}]`;
        
        const methodUsed = item.method;
        let methodText = '';
        if (methodUsed === 'z') {
            methodText = 'Z-Distribution';
        } else if (methodUsed === 't') {
            methodText = 'T-Distribution';
        } else {
            methodText = 'Auto-Selected';
        }
        document.getElementById('printCiMethodUsed').textContent = `${methodText} | Critical Value = ${item.calculation.crit.toFixed(3)}`;
        
        document.getElementById('printTestStatDisplay').textContent = item.calculation.stat.toFixed(3);
        document.getElementById('printDfDisplay').textContent = item.calculation.df ? item.calculation.df.toFixed(2) : '--';
        document.getElementById('printEffectSizeDisplay').textContent = item.calculation.d ? Math.abs(item.calculation.d).toFixed(2) : '-';
        document.getElementById('printMeanDiffDisplay').textContent = item.calculation.diff.toFixed(3);
        
        const printHypoBadge = document.getElementById('printHypoBadge');
        printHypoBadge.innerText = sig ? 'Reject H‚ÇÄ / Accept H‚ÇÅ' : 'Accept H‚ÇÄ';
        printHypoBadge.className = sig ? 'h-badge h-reject' : 'h-badge h-accept';
        
        let es = Math.abs(item.calculation.d || 0), interp = "Negligible";
        if(es >= 0.2) interp = "Small";
        if(es >= 0.5) interp = "Medium";
        if(es >= 0.8) interp = "Large";
        document.getElementById('printEsValBox').innerText = es.toFixed(2);
        document.getElementById('printEsInterpBox').innerText = interp;
        
        document.getElementById('printThesisText').innerText = `‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏ô‡∏±‡∏¢‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö ${ciLevel}% (p = ${item.calculation.p.toFixed(3)})`;
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢
        const conclusionText = generateConclusionTextForHistory(item);
        document.getElementById('printConclusionText').textContent = conclusionText;
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
        const settingsTable = document.getElementById('printSettingsTable');
        settingsTable.innerHTML = `
            <tr>
                <td>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô</td>
                <td>${ciLevel}%</td>
                <td>‡∏Ñ‡πà‡∏≤ Alpha = ${(1-confidenceLevel).toFixed(3)}</td>
            </tr>
            <tr>
                <td>‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</td>
                <td>${methodText}</td>
                <td>${item.method === 'auto' ? '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥' : '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á'}</td>
            </tr>
            <tr>
                <td>Critical Value</td>
                <td>${item.calculation.crit.toFixed(3)}</td>
                <td>‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ä‡πà‡∏ß‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô</td>
            </tr>
        `;
    }
    
    function generateConclusionTextForHistory(item) {
        const confidenceLevel = item.confidenceLevel;
        const ciLevel = Math.round(confidenceLevel * 100);
        const sig = item.calculation.p < (1 - confidenceLevel);
        const testName = getTestTypeName(item.testType);
        
        let conclusion = `‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏î‡πâ‡∏ß‡∏¢ ${testName} `;
        
        if (sig) {
            conclusion += `‡∏û‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏ô‡∏±‡∏¢‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö ${ciLevel}% (p = ${item.calculation.p < 0.001 ? '< .001' : item.calculation.p.toFixed(3)}). `;
        } else {
            conclusion += `‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏ô‡∏±‡∏¢‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö ${ciLevel}% (p = ${item.calculation.p.toFixed(3)}). `;
        }
        
        conclusion += `‡∏ä‡πà‡∏ß‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô ${ciLevel}% ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà [${item.calculation.lower.toFixed(2)}, ${item.calculation.upper.toFixed(2)}]. `;
        
        if (item.calculation.d) {
            const es = Math.abs(item.calculation.d);
            let esLevel = "‡∏ï‡πà‡∏≥‡∏°‡∏≤‡∏Å";
            if(es >= 0.2) esLevel = "‡∏ï‡πà‡∏≥";
            if(es >= 0.5) esLevel = "‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á";
            if(es >= 0.8) esLevel = "‡∏™‡∏π‡∏á";
            
            conclusion += `‡∏Ç‡∏ô‡∏≤‡∏î‡∏≠‡∏¥‡∏ó‡∏ò‡∏¥‡∏û‡∏• (Cohen's d) ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö ${es.toFixed(2)} ‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏±‡∏î‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö ${esLevel}.`;
        }
        
        return conclusion;
    }
    
    function printReport() {
        if (!lastCalculation) {
            alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡πà‡∏≠‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô');
            return;
        }
        
        // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå
        preparePrintData();
        
        // ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå
        window.print();
    }
    
    function preparePrintData() {
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå
        const now = new Date();
        document.getElementById('printDate').textContent = now.toLocaleDateString('th-TH', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
        
        document.getElementById('printUser').textContent = document.getElementById('piName').value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠';
        document.getElementById('printTitle').textContent = document.getElementById('titleName').value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á';
        document.getElementById('printPI').textContent = document.getElementById('piName').value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠';
        document.getElementById('printCoResearchers').textContent = coResearchers.join(', ') || '--';
        document.getElementById('printTestType').textContent = getTestTypeName(currentTestType);
        document.getElementById('printAnalysisDate').textContent = now.toLocaleDateString('th-TH', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö
        let testDataHTML = '';
        if (currentTestType === 'two-sample') {
            const m1 = document.getElementById('m1').value || '--';
            const sd1 = document.getElementById('sd1').value || '--';
            const n1 = document.getElementById('n1').value || '--';
            const m2 = document.getElementById('m2').value || '--';
            const sd2 = document.getElementById('sd2').value || '--';
            const n2 = document.getElementById('n2').value || '--';
            
            testDataHTML = `
                <table class="print-table">
                    <thead>
                        <tr>
                            <th>‡∏Å‡∏•‡∏∏‡πà‡∏°</th>
                            <th>Mean</th>
                            <th>SD</th>
                            <th>n</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏î‡∏•‡∏≠‡∏á (Exp)</td>
                            <td>${m1}</td>
                            <td>${sd1}</td>
                            <td>${n1}</td>
                        </tr>
                        <tr>
                            <td>‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° (Ctrl)</td>
                            <td>${m2}</td>
                            <td>${sd2}</td>
                            <td>${n2}</td>
                        </tr>
                    </tbody>
                </table>
            `;
        } else if (currentTestType === 'one-sample') {
            const m = document.getElementById('mOne').value || '--';
            const sd = document.getElementById('sdOne').value || '--';
            const n = document.getElementById('nOne').value || '--';
            const mu0 = document.getElementById('mu0').value || '--';
            
            testDataHTML = `
                <table class="print-table">
                    <thead>
                        <tr>
                            <th>‡∏Ñ‡πà‡∏≤‡∏ó‡∏î‡∏™‡∏≠‡∏ö</th>
                            <th>‡∏Ñ‡πà‡∏≤</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Mean ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</td>
                            <td>${m}</td>
                        </tr>
                        <tr>
                            <td>SD ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</td>
                            <td>${sd}</td>
                        </tr>
                        <tr>
                            <td>n</td>
                            <td>${n}</td>
                        </tr>
                        <tr>
                            <td>Mean ‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£ (Œº‚ÇÄ)</td>
                            <td>${mu0}</td>
                        </tr>
                    </tbody>
                </table>
            `;
        } else {
            const x1 = document.getElementById('xP1').value || '--';
            const n1 = document.getElementById('nP1').value || '--';
            const x2 = document.getElementById('xP2').value || '--';
            const n2 = document.getElementById('nP2').value || '--';
            const p1 = x1 !== '--' && n1 !== '--' ? (x1/n1).toFixed(3) : '--';
            const p2 = x2 !== '--' && n2 !== '--' ? (x2/n2).toFixed(3) : '--';
            
            testDataHTML = `
                <table class="print-table">
                    <thead>
                        <tr>
                            <th>‡∏Å‡∏•‡∏∏‡πà‡∏°</th>
                            <th>Events (x)</th>
                            <th>Total (n)</th>
                            <th>Proportion (p)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà 1</td>
                            <td>${x1}</td>
                            <td>${n1}</td>
                            <td>${p1}</td>
                        </tr>
                        <tr>
                            <td>‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà 2</td>
                            <td>${x2}</td>
                            <td>${n2}</td>
                            <td>${p2}</td>
                        </tr>
                    </tbody>
                </table>
            `;
        }
        
        document.getElementById('testDataPrint').innerHTML = testDataHTML;
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå
        const confidenceLevel = parseFloat(document.getElementById('confidenceLevel').value);
        const ciLevel = Math.round(confidenceLevel * 100);
        const sig = lastCalculation.p < (1 - confidenceLevel);
        
        document.getElementById('printTestName').textContent = getTestTypeName(currentTestType);
        document.getElementById('printTestStat').textContent = lastCalculation.stat.toFixed(3);
        document.getElementById('printDf').textContent = lastCalculation.df ? lastCalculation.df.toFixed(2) : '--';
        document.getElementById('printPValue').textContent = lastCalculation.p < 0.001 ? '< .001' : lastCalculation.p.toFixed(3);
        document.getElementById('printEffectSize').textContent = lastCalculation.d ? Math.abs(lastCalculation.d).toFixed(2) : '--';
        document.getElementById('printCi').textContent = `[${lastCalculation.lower.toFixed(2)}, ${lastCalculation.upper.toFixed(2)}]`;
        document.getElementById('printCiHeader').textContent = `${ciLevel}% CI`;
        
        document.getElementById('printPValueDisplay').textContent = lastCalculation.p < 0.001 ? '< .001' : lastCalculation.p.toFixed(3);
        document.getElementById('printPValueCard').className = sig ? 'p-value-card sig' : 'p-value-card ns';
        document.getElementById('printPInterpretation').textContent = sig ? 'Significant' : 'Not Significant';
        
        document.getElementById('printCiDisplay').textContent = `[${lastCalculation.lower.toFixed(2)}, ${lastCalculation.upper.toFixed(2)}]`;
        
        const methodUsed = getSelectedMethod();
        let methodText = '';
        if (methodUsed === 'z') {
            methodText = 'Z-Distribution';
        } else if (methodUsed === 't') {
            methodText = 'T-Distribution';
        } else {
            methodText = 'Auto-Selected';
        }
        document.getElementById('printCiMethodUsed').textContent = `${methodText} | Critical Value = ${lastCalculation.crit.toFixed(3)}`;
        
        document.getElementById('printTestStatDisplay').textContent = lastCalculation.stat.toFixed(3);
        document.getElementById('printDfDisplay').textContent = lastCalculation.df ? lastCalculation.df.toFixed(2) : '--';
        document.getElementById('printEffectSizeDisplay').textContent = lastCalculation.d ? Math.abs(lastCalculation.d).toFixed(2) : '-';
        document.getElementById('printMeanDiffDisplay').textContent = lastCalculation.diff.toFixed(3);
        
        const printHypoBadge = document.getElementById('printHypoBadge');
        printHypoBadge.innerText = sig ? 'Reject H‚ÇÄ / Accept H‚ÇÅ' : 'Accept H‚ÇÄ';
        printHypoBadge.className = sig ? 'h-badge h-reject' : 'h-badge h-accept';
        
        let es = Math.abs(lastCalculation.d || 0), interp = "Negligible";
        if(es >= 0.2) interp = "Small";
        if(es >= 0.5) interp = "Medium";
        if(es >= 0.8) interp = "Large";
        document.getElementById('printEsValBox').innerText = es.toFixed(2);
        document.getElementById('printEsInterpBox').innerText = interp;
        
        document.getElementById('printThesisText').innerText = `‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏ô‡∏±‡∏¢‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö ${ciLevel}% (p = ${lastCalculation.p.toFixed(3)})`;
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢
        const conclusionText = generateConclusionText();
        document.getElementById('printConclusionText').textContent = conclusionText;
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
        const settingsTable = document.getElementById('printSettingsTable');
        settingsTable.innerHTML = `
            <tr>
                <td>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô</td>
                <td>${ciLevel}%</td>
                <td>‡∏Ñ‡πà‡∏≤ Alpha = ${(1-confidenceLevel).toFixed(3)}</td>
            </tr>
            <tr>
                <td>‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</td>
                <td>${methodText}</td>
                <td>${currentMethod === 'auto' ? '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥' : '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á'}</td>
            </tr>
            <tr>
                <td>Critical Value</td>
                <td>${lastCalculation.crit.toFixed(3)}</td>
                <td>‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ä‡πà‡∏ß‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô</td>
            </tr>
        `;
    }
    
    function getTestTypeName(testType) {
        switch(testType) {
            case 'two-sample': return 'Independent t-test (2 ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏¥‡∏™‡∏£‡∏∞)';
            case 'one-sample': return 'One-Sample t-test (‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)';
            case 'proportion': return 'Proportion Z-Test (2 ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô)';
            default: return '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó';
        }
    }
    
    function generateConclusionText() {
        const confidenceLevel = parseFloat(document.getElementById('confidenceLevel').value);
        const ciLevel = Math.round(confidenceLevel * 100);
        const sig = lastCalculation.p < (1 - confidenceLevel);
        const testName = getTestTypeName(currentTestType);
        
        let conclusion = `‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏î‡πâ‡∏ß‡∏¢ ${testName} `;
        
        if (sig) {
            conclusion += `‡∏û‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏ô‡∏±‡∏¢‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö ${ciLevel}% (p = ${lastCalculation.p < 0.001 ? '< .001' : lastCalculation.p.toFixed(3)}). `;
        } else {
            conclusion += `‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏ô‡∏±‡∏¢‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö ${ciLevel}% (p = ${lastCalculation.p.toFixed(3)}). `;
        }
        
        conclusion += `‡∏ä‡πà‡∏ß‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô ${ciLevel}% ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà [${lastCalculation.lower.toFixed(2)}, ${lastCalculation.upper.toFixed(2)}]. `;
        
        if (lastCalculation.d) {
            const es = Math.abs(lastCalculation.d);
            let esLevel = "‡∏ï‡πà‡∏≥‡∏°‡∏≤‡∏Å";
            if(es >= 0.2) esLevel = "‡∏ï‡πà‡∏≥";
            if(es >= 0.5) esLevel = "‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á";
            if(es >= 0.8) esLevel = "‡∏™‡∏π‡∏á";
            
            conclusion += `‡∏Ç‡∏ô‡∏≤‡∏î‡∏≠‡∏¥‡∏ó‡∏ò‡∏¥‡∏û‡∏• (Cohen's d) ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö ${es.toFixed(2)} ‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏±‡∏î‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö ${esLevel}.`;
        }
        
        return conclusion;
    }

    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
    window.onload = function() {
        updateZValueDisplay();
        updateAutoRecommendation();
        updateMethodUI();
        loadHistory();
    };
</script>

</body>
</html>
